# REQ-015: Group Management & Drag-and-Drop

**ID:** REQ-015
**Domain:** Control
**Status:** Draft
**Priority:** P1 (Important)

## Description

The application MUST allow users to reassign clients between groups via drag-and-drop and context menus, using the Snapcast `Group.SetClients` JSON-RPC method.

## Acceptance Criteria

- [ ] Drag a client card from one group to another to reassign it
- [ ] Visual drag feedback: ghost preview of client card while dragging
- [ ] Drop target highlighting on valid group cards during drag
- [ ] Context menu "Move to Group..." with submenu listing available groups
- [ ] `Group.SetClients` API call wired up in `SnapcastClient`
- [ ] Server state refreshed after successful reassignment
- [ ] Handle edge cases: last client in group (server auto-deletes empty groups)
- [ ] Handle disconnected clients (allow reassignment of offline clients)
- [ ] Undo support: show brief toast/notification with "Undo" after move
- [ ] Keyboard accessible: move client via context menu without mouse drag

## Implementation Notes

- **API:** `Group.SetClients` takes `{id: group_id, clients: [client_id, ...]}` — only one call needed to the target group with the moved client appended; the server automatically removes the client from its previous group
- **Drag source:** `ClientCard` — implement `mouseMoveEvent` to start `QDrag` with client ID as MIME data
- **Drop target:** `GroupCard` — implement `dragEnterEvent`, `dragMoveEvent`, `dropEvent` with `setAcceptDrops(True)`
- **State:** `ServerState.get_clients_for_group()` and `get_group_for_client()` already exist for resolving membership
- **Server response:** `Group.SetClients` returns full server state — feed into `_parse_server_status()` to refresh UI
- **Hardcoded values:** None — group/client IDs are dynamic from server

## References

- [Snapcast JSON-RPC API](https://github.com/badaix/snapcast/blob/master/doc/json_rpc_api/control.md)
